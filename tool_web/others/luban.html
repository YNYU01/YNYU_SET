<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鲁班尺查询工具</title>
    <style>
        body {
            font-family: "Microsoft YaHei", sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .control-panel {
            width: 100%;
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }
        select, input, button {
            padding: 8px;
            box-sizing: box-border;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        input {
            min-width: 20px;
            flex: 1;
        }
        button {
            background-color: #222;
            color: white;
            cursor: pointer;
            min-width: 80px;
            border: none;
        }
        button:hover {
            background-color: #ef2222;
        }
        
        .ruler-container {
            width: 100%;
            max-width: 800px;
            overflow-x: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px 0;
            background-color: #ffdd44;
            position: relative;
            margin-top: 20px;
            height: 360px;
            overflow-y: hidden;
        }
        .ruler {
            position: relative;
            white-space: nowrap;
            width: max-content;
            margin-left: 10px;
        }
        
        .ruler-title{
            padding-left: var(--lineleft,0);
            height: 20px;
            text-align: left;
            line-height: 20px;
            font-weight: bold;
        }

        /* --- 大格子样式 (上层) --- */
        .ruler-segment {
            display: inline-block;
            height: 20px; /* 变矮，作为背景 */
            text-align: center;
            line-height: 20px;
            font-weight: bold;
            box-sizing: border-box;
            border-right: 1px solid rgba(255,255,255,0.3);
            font-size: 14px;
            vertical-align: top;
        }
        /* 大格颜色 */
        .cai, .yi, .guan, .ben { background:#d42222; color: #fff; }
        .bing, .li, .jie, .hai { background: #222; color:#eee}

        /* --- 小格子样式 (下层) --- */
        .sub-ruler {
            position: relative;
            height: 20px; /* 变高，作为信息主体 */
            font-size: 0;
            border-top: 1px solid #000;
            border-bottom: 1px solid #000;
            
        }
        .sub-segment {
            display: inline-block;
            height: 20px;
            line-height: 20px;
            font-size: 13px;
            text-align: center;
            box-sizing: border-box;
            border-right: 1px solid #000;
            overflow: hidden;
            font-weight: normal;
        }
        /* 小格颜色：吉(橙色系), 凶(灰色系) */
        .sub-segment.lucky { background-color: #f89d66; color: #333; }
        .sub-segment.unlucky { background-color: #444; color: #ccc; }

        /* --- 刻度条 --- */
        .marks-container {
            position: relative;
            height: 30px;
            margin-bottom: 30px;
        }
        .mark {
            position: absolute;
            width: 1px;
            background-color: black;
            top: 0;
        }
        .mark.minor { height: 14px; }
        .mark.major { height: 20px; }
        .mark.mini { height: 7px; }
        .mark.mini.center { height: 10px; }
        
        .mark-text {
            position: absolute;
            top: 70%;
            left: -10px;
            font-size: 18px;
            font-weight: 700;
            color: #ef2222;
            width: fit-content;
            text-align: center;
            transform: translateX(-50%)
        }
        .mark-text-mini {
            position: absolute;
            bottom: -10px;
            left: -10px;
            font-size: 14px;
            font-weight: 700;
            color: #000;
            width: 20px;
            text-align: center;
        }

        /* --- 红线 --- */
        .indicator {
            position: absolute;
            top: 0;
            width: 2px;
            height: 100%;
            z-index: 10;
            border-left: 1px dashed #000;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        
        <div class="control-panel">
          
            <input type="number" id="inputLength" placeholder="输入尺寸 (cm)" min="0" step="0.1" value="6">
            <button onclick="queryLength()">查询</button>
        </div>


        <div class="ruler-container" id="rulerContainer">
            <div id="ruler" class="ruler"></div>
            <div id="indicator" class="indicator" ></div>
        </div>
        
        <div style="display:flex; flex-wrap: wrap; gap:10px; margin-top:10px; font-size: 12px; ">
            <li>
                台湾/赣南尺又叫春秋尺，遵循古法或者客家流派的工匠常用，粤东地区也有用；
            </li>
            <li>
                北京尺又叫明清尺，由故宫文物复刻；
            </li>
            <li>
                广东/香港尺是近代流行版本，更符合当代建筑规格喜好，比较紧凑；
            </li>
            <div style="font-size:10px; width: 100%; transform:skewX(-10deg); opacity:0.3; text-align:right">
                * 本内容仅供娱乐，请勿迷信
            </div>
        </div>
    </div>

    <script>
        // 主星 (大格)
        const LUBAN_WORDS = ["财", "病", "离", "义", "官", "劫", "害", "本"];
        const LUCKY_WORDS = ["财", "义", "官", "本"];

        // 辅星 (小格) - 每个数组对应上面一个大格的4个细分
        const SUB_WORDS = [
            ["财德", "宝库", "六合", "迎福"], // 财
            ["退财", "公事", "孤寡", "牢执"], // 病
            ["长库", "劫财", "官鬼", "失脱"], // 离
            ["添丁", "益利", "贵子", "大吉"], // 义
            ["顺科", "横财", "进益", "富贵"], // 官
            ["死别", "退口", "离乡", "财失"], // 劫
            ["灾至", "死绝", "病临", "口舌"], // 害
            ["财至", "登科", "兴旺", "福寿"]  // 本
        ];

        // DOM元素
        const inputLength = document.getElementById('inputLength');
        const rulerContainer = document.getElementById('rulerContainer');
        const ruler = document.getElementById('ruler');
        const indicator = document.getElementById('indicator');

        // 配置：增加每厘米像素值，确保小格子文字能显示全
        const PX_PER_CM = 30; 
        const TOTAL_CM = 600; 

        // 初始化
        generateRuler(50.4,1);
        generateRuler(46.08,2);
        generateRuler(42.9,3);
        queryLength();

        function generateRuler(data,type = 1) {
            const unitLen = data ||  parseFloat(rulerTypeSelect.value);
            
            //ruler.innerHTML = '';
            let typetitle = [
                "台湾/赣南尺（50.4）",
                "北京尺（46.08）",
                "广东/香港尺（42.9）",
            ]
          let title = document.createElement('div');
          title.className = "ruler-title"
          title.innerHTML = typetitle[type - 1];
ruler.appendChild(title);
            // 1. 生成大格子 (上层)
            const bigSegmentWidthPx = (unitLen / 8) * PX_PER_CM;
            for (let i = 0; i < TOTAL_CM * 8 / unitLen; i++) {
                const wordIndex = i % 8;
                const word = LUBAN_WORDS[wordIndex];
                const seg = document.createElement('div');
                seg.className = `ruler-segment ${getWordClass(word)}`;
                seg.style.width = `${bigSegmentWidthPx}px`;
                seg.textContent = word;
                ruler.appendChild(seg);
            }

            // 2. 生成小格子 (中层)
            const subRuler = document.createElement('div');
            subRuler.className = 'sub-ruler';
            const subSegmentWidthPx = (unitLen / 32) * PX_PER_CM; // 32格

            for (let i = 0; i < TOTAL_CM * 32 / unitLen; i++) {
                const bigIndex = Math.floor(i / 4) % 8; // 找到对应的大格索引
                const subIndex = i % 4; // 小格在大格内的索引
                
                const word = SUB_WORDS[bigIndex][subIndex];
                const seg = document.createElement('div');
                // 根据对应的大格颜色决定小格分类
                seg.className = `sub-segment ${LUCKY_WORDS.includes(LUBAN_WORDS[bigIndex]) ? 'lucky' : 'unlucky'}`;
                seg.style.width = `${subSegmentWidthPx}px`;
                seg.textContent = word;
                subRuler.appendChild(seg);
            }
            ruler.appendChild(subRuler);

            // 3. 生成刻度条 (下层)
            const marksDiv = document.createElement('div');
            marksDiv.className = 'marks-container';
            marksDiv.style.width = `${TOTAL_CM * PX_PER_CM}px`;
            
            for (let cm = 0; cm <= TOTAL_CM; cm++) {
                const isMajor = (cm % 10 === 0);
                const leftPosPx = cm * PX_PER_CM;
                const mark = document.createElement('div');
                mark.className = `mark ${isMajor ? 'major' : 'minor'}`;
                mark.style.left = `${leftPosPx}px`;
                marksDiv.appendChild(mark);
                for (let mm = 0; mm <= 10; mm++){
                    const leftMm = leftPosPx + PX_PER_CM/10*mm;
                    const markMm = document.createElement('div');
                markMm.className = 'mark mini';
                if(mm == 5) markMm.className = 'mark mini center';
                markMm.style.left = `${leftMm}px`;
                marksDiv.appendChild(markMm);
                }
                if (isMajor) {
                    const text = document.createElement('div');
                    text.className = 'mark-text';
                    text.style.left = `${leftPosPx}px`;
                    text.textContent = cm;
                    marksDiv.appendChild(text);
                }else{
                    const text = document.createElement('div');
                    text.className = 'mark-text-mini';
                    text.style.left = `${leftPosPx - 10}px`;
                    text.textContent = cm%10;
                    marksDiv.appendChild(text);
                }
            }
            ruler.appendChild(marksDiv);
        }

        function getWordClass(word) {
            const map = { "财": "cai", "病": "bing", "离": "li", "义": "yi", 
                         "官": "guan", "劫": "jie", "害": "hai", "本": "ben" };
            return map[word] || "";
        }

        function queryLength(left) {
            
            const length = parseFloat(inputLength.value);


            // 移动红线
            const leftPosPx = length * PX_PER_CM;
            document.documentElement.style.setProperty("--lineleft",left + "px");
            indicator.style.left = leftPosPx  + "px";
            // 滚动
            if(left) return;
            setTimeout(() => {
                rulerContainer.scrollTo({
                    left: leftPosPx -  rulerContainer.offsetWidth/3*2,
                    behavior: 'smooth'
                });
            }, 100);
        }
        rulerContainer.addEventListener('scroll', function() {
    // 获取该元素的滚动距离
    
    const scrollLeft = rulerContainer.scrollLeft || 0.1;
    queryLength(scrollLeft)
});

        
    </script>
</body>
</html>
