# 待优化 / TODO（散乱功能点记录）

后续一点点优化用，按优先级或排期自行安排。

---

## 1. TV 组件化

- **现状**：TV（公告滚动）目前是 data-* 用法，需手写结构。
- **目标**：做成可组件化（自定义标签或 COMP_CREATE），关键增强是 **多宽度断点参数**。
- **要点**：支持多个宽度断点配置，便于不同布局/响应式下的表现一致。

---

## 2. 中英文 / 本地语言 + 英语 兼容逻辑统一

- **现状**：tips、input、textarea-eg 等很多场景都有「本地语言 + 英语」诉求，但实现较散乱。
- **问题**：
  - 为规避「同步加载 CSS 导致阻塞」引入了动态修改字体，影响了逻辑流畅。
  - 生产里双语切换容易出现 **同步顺序问题**（顺序灾难）：例如动态生成内容时，还要再判断一次「当前语言」「语言切换事件是否已执行」。
- **目标**：梳理一套统一的「当前语言 + 双语文案」的读写与切换流程，避免：
  - 动态生成内容与语言状态不同步；
  - 语言切换事件与渲染/字体加载顺序错乱。
- **可做**：集中管理「语言状态 + 文案源」，切换时单点派发、按固定顺序更新 DOM/字体，动态插入的节点也能挂到同一套逻辑上。

---

## 3. comp.js 与 tool.js 的边界与依赖

- **现状**：两者互相影响，有时无法单独引入；完全拆开又可能重复函数，同时引用又怕冲突。
- **目标**：厘清边界与依赖，后续可考虑：
  - 抽离公共函数到独立小模块（如 utils），comp / tool 各引所需；
  - 或约定「谁为主、谁为扩展」，避免循环依赖与命名冲突。
- **待研究**：依赖关系图、重复函数列表、单独引入的典型场景，再决定拆分策略。

---

## 4. icon.js 图标构建工具化

- **现状**：每次都要手写「拼接字符串」的方式注册自定义标签，维护成本高。
- **目标**：做一个小工具 / 数据结构：
  - 用 **对象** 记录：**标签名** + **SVG 字符串**（或 path 等）；
  - **遍历该对象**，统一 `customElements.define` 生成自定义标签。
- **效果**：新增/修改图标只需改对象里的条目，不再到处改拼接代码。

---

## 5. 页面卡顿与资源加载阻塞

- **现状**：很多页面存在卡顿，与资源加载阻塞关系很大。
- **矛盾**：UI 侧做占位工作量大；直接加 loading 又很粗暴。
- **目标**：进一步研究「加载策略 + 占位/骨架」的平衡，例如：
  - 关键资源优先、非关键延迟/懒加载；
  - 轻量占位（骨架屏或最小占位）与 loading 的适用场景；
  - 避免主线程长时间被阻塞（大脚本拆分、defer/async 使用）。
- **待研究**：具体卡顿场景、阻塞点、可接受的占位粒度与实现成本。

---

## 6. 缓存管理与同源双刃剑、环境差异

- **现状**：最初的缓存管理没有充分考虑「同源」的双刃剑效应；仓库会越来越大，问题会更突出。
- **环境差异**：
  - 在线页面 / 插件；
  - 本地（直接运行）页面 / 插件；
  - 本地服务器页面 / 插件。
- **新因素**：同插件在不同宿主下却共用同一份缓存数据，容易造成数据错乱或覆盖，堪称灾难。
- **目标**：重新梳理缓存策略，按「环境 + 宿主 + 用途」区分存储（如 key 前缀、独立 storage、或命名空间），避免跨环境/跨宿主误用同一缓存。

---

## 7. 构建脚本与命令行管理

- **现状**：插件构建（如 `npx webpack`）和其他内容构建（如 `npm run`）管理较散乱，经常要开多个命令行界面。
- **目标**：统一或串联构建入口，例如：
  - 一个命令按需执行「插件构建 + 其他构建」；
  - 或通过 npm scripts 组合（如 `npm run build:all` / `build:plugin` / `build:site`），减少多开终端的需求。
- **可做**：整理现有脚本、写一个总控脚本或 package.json 脚本组合，并简单文档化。

---

## 8. 批量配置页面的 \<head\> 与 \<script\>（路径与目录）

- **需求**：需要一套构建/配置逻辑，能 **批量** 配置页面的 `<head>` 和 `<script>`，并自动处理 `../` 的数量（相对路径深度）。
- **进阶**：
  - 涉及 **目录获取**（根据页面所在目录计算相对路径）；
  - 部分资源需要 **转绝对路径**（如域名拼接），以适配在线/本地服务器等不同环境。
- **目标**：通过脚本或构建步骤生成/注入正确的引用，避免手改多页、减少 `../` 写错导致的 404。

---

## 9. 后端逻辑与规模化衔接

- **背景**：后续若形成规模，会用到服务器做高级图像计算、WebGPU、开源赞助/赞助权限等，需要和现有前端/插件衔接顺畅。
- **目标**：提前考虑后端逻辑与接口形态，便于：
  - **服务器端**：图像处理、WebGPU 等重计算任务的部署与调用方式；
  - **赞助/权限**：开源赞助、功能权限控制与前端鉴权、缓存的配合；
  - **前后端边界**：接口约定、错误处理、离线/降级策略。
- **可做**：先列清「未来要上的后端能力」清单，再定简单的接口与鉴权草案，避免后期大改。

---


